# cvprac-auto-reconcile

## What is it?
1. A script using aristanetworks cvprac library to auto-reconcile nodes on a CloudVision cluster
2. A script that can be executed from anywhere if requirements / setup are complete

## Why use this?
1. If you use other Open Source Tools like Ansible to manage your configurations, but it's important to have CloudVision Portal up-to-date.
2. If you use CVP to manage your infrastructure and need a way to reconcile all your devices quickly. Two scenarios come to mind:
    1. Brownfield deployment of CVP, quickly get all your nodes up to date
    2. Large troubleshooting event, quickly get all fixes into CVP

## How it works?
1. Uses Arista Networks published cvprac python library
2. Connects to CVP node(s)
3. Initiates compliance check for each device in the inventory
4. Updates and/or creates reconcile configlets for each node that fails compliance check
5. Saves topology with reconcile configlets applied (where it's needed) 
6. Delets all pending tasks generated by the script
7. Re-runs compliance checks for all failed devices

## Requirements / Setup
1. Verify the following python libraries are installed
    1. cvprac

2. Setup cfg file with username/password on system where the script will be executed.
    1. sudo vim /etc/auto-reconcile.cfg

```
[authentication]
username='arista'
password='arista'

[cvp_instances]
nodes='node1,node2,node3'
```

3. Setup crontab entry to run on system or kick off manually

```
crontab -e

# Run every 15 minutes
15 * * * * python auto-reconcile.py

# Run from cmd line
arista@system1:~/projects/cvprac-auto-reconcile$ python auto-reconcile.py
```